<script>
document.addEventListener("DOMContentLoaded", function () {

    // Get data from URL
    const urlParams = new URLSearchParams(window.location.search);
    const vehicle = urlParams.get("vehicle");
    const pack = urlParams.get("pack");
    const price = urlParams.get("price");

    if (vehicle) {
        document.getElementById("selectedPack").value = vehicle;
    }

    if (pack) {
        document.getElementById("selectedPack").value = pack;
    }

    if (price) {
        document.getElementById("amountField").value = "â‚¹" + price;
    }
});


// DISCORD WEBHOOK SUBMIT
document.getElementById("Customer").addEventListener("submit", function(e) {
    e.preventDefault();

    const pname = document.querySelector("[name='pname']").value;
    const dname = document.querySelector("[name='dname']").value;
    const pack = document.getElementById("selectedPack").value;
    const amount = document.getElementById("amountField").value;
    const paymentProofFile = document.querySelector("[name='paymentProof']").files[0];

    // ðŸ”´ PUT ONLY ONE WEBHOOK HERE
    const webhookURL = "https://discord.com/api/webhooks/1469756792908152883/bYlDZ5hHPPDeN_wdd1HLOCUqSGeXPC-PWNyJHOIv_zEiA99tXEzCMDWRA46Cc24NEdKH", 
        "https://discord.com/api/webhooks/1470090123080106156/3AqTyeYpozL26bebIpjkgaFaXXtvl2JI2hMyjx34FzLr7k_vMimCexkmY4h4ClutJZvB";

    const data = {
        content: "*New Order Request* <@&1461606860372316377> <@&1461606866810437702>",
        embeds: [{
            title: "ðŸ›’ ASCEND PURCHASE",
            color: 16711935,
            fields: [
                { name: "IC Name", value: pname, inline: true },
                { name: "Discord Name", value: dname, inline: true },
                { name: "Pack / Vehicle", value: pack || "Not Provided", inline: true },
                { name: "Amount", value: amount || "Not Provided", inline: true },
                { name: "Payment Proof", value: paymentProofFile ? paymentProofFile.name : "Not Provided", inline: false }
            ],
            footer: {
                text: "ASCEND SYSTEM"
            },
            timestamp: new Date().toISOString()
        }]
    };

    const formData = new FormData();
    formData.append("payload_json", JSON.stringify(data));

    if (paymentProofFile) {
        formData.append("file", paymentProofFile);
    }

    fetch(webhookURL, {
        method: "POST",
        body: formData
    })
    .then(res => {
        if (res.ok) {
            alert("âœ… Application Submitted Successfully!");
            document.getElementById("Customer").reset();
        } else {
            alert("âŒ Error sending to Discord");
        }
    })
    .catch(err => {
        console.error(err);
        alert("âš  Webhook error");
    });
});
</script>
